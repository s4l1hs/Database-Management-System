{% extends "base.html" %}

{% block title %}Energy | {{ action }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="h4 mb-3">
    {{ "Add New Energy Record" if action == "Add" else "Edit Energy Record" }}
  </h1>

  <form
    method="post"
    action="{% if action == 'Add' %}
                {{ url_for('energy.add_energy') }}
            {% else %}
                {{ url_for('energy.edit_energy', id=record.data_id) }}
            {% endif %}"
    class="row g-3"
  >
    {# Country #}
    <div class="col-md-4">
      <label for="country_id" class="form-label">Country</label>
      <select
        id="country_id"
        name="country_id"
        class="form-select"
        {% if action == 'Edit' %}disabled{% endif %}
        required
      >
        <option value="" disabled
          {% if action == 'Add' %}selected{% endif %}
        >
          Select country...
        </option>
        {% for c in countries %}
          <option value="{{ c.country_id }}"
            {% if action == 'Edit' and c.country_id == record.country_id %}selected{% endif %}
          >
            {{ c.country_name }} ({{ c.country_code }})
          </option>
        {% endfor %}
      </select>
      {% if action == 'Edit' %}
        <div class="form-text">Country cannot be changed while editing.</div>
      {% endif %}
    </div>

    {# Indicator #}
    <div class="col-md-4">
      <label for="energy_indicator_id" class="form-label">Indicator</label>
      <select
        id="energy_indicator_id"
        name="energy_indicator_id"
        class="form-select"
        {% if action == 'Edit' %}disabled{% endif %}
        required
      >
        <option value="" disabled
          {% if action == 'Add' %}selected{% endif %}
        >
          Select indicator...
        </option>
        {% for ind in indicators %}
          <option value="{{ ind.energy_indicator_id }}"
            {% if action == 'Edit' and ind.energy_indicator_id == record.energy_indicator_id %}selected{% endif %}
          >
            {{ ind.indicator_name }} ({{ ind.measurement_unit or '-' }})
          </option>
        {% endfor %}
      </select>
      {% if action == 'Edit' %}
        <div class="form-text">Indicator cannot be changed while editing.</div>
      {% endif %}
    </div>

    {# Year #}
    <div class="col-md-2">
      <label for="year" class="form-label">Year</label>
      <input
        type="number"
        class="form-control"
        id="year"
        name="year"
        min="1900"
        max="2100"
        value="{{ record.year if record else '' }}"
        required
      />
    </div>

    {# Value #}
    <div class="col-md-2">
      <label for="indicator_value" class="form-label">Value</label>
      <input
        type="number"
        step="0.0001"
        class="form-control"
        id="indicator_value"
        name="indicator_value"
        value="{{ record.indicator_value if record else '' }}"
        required
      />
    </div>

    {# Data Source (Source Notes) #}
    <div class="col-12">
      <label for="data_source" class="form-label">Data Source</label>
      <textarea
        id="data_source"
        name="data_source"
        rows="3"
        class="form-control"
      >{{ record.data_source if record else '' }}</textarea>
    </div>

    <div class="col-12 mt-3">
      <button type="submit" class="btn btn-primary">
        {{ "Create" if action == "Add" else "Update" }}
      </button>
      <a href="{{ url_for('energy.list_energy') }}" class="btn btn-secondary ms-2">
        Cancel
      </a>
    </div>
  </form>
</div>
{% endblock %}
