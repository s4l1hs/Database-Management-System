{% extends "base.html" %}

{% block title %}Freshwater | {{ action }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="h4 mb-3">
    {{ "Add New Freshwater Record" if action == "Add" else "Edit Freshwater Record" }}
  </h1>

  <form
    method="post"
    action="{% if action == 'Add' %}
                {{ url_for('freshwater.add_freshwater') }}
            {% else %}
                {{ url_for('freshwater.edit_freshwater', id=record.data_id) }}
            {% endif %}"
    class="row g-3"
  >
    <div class="col-md-4">
      <label for="country_id" class="form-label">Country</label>
      <select
        id="country_id"
        name="country_id"
        class="form-select"
        {% if action == 'Edit' %}disabled{% endif %}
        required
      >
        <option value="" disabled {% if action == 'Add' %}selected{% endif %}>
          Select country...
        </option>
        {% for c in countries %}
          <option value="{{ c.country_id }}"
            {% if action == 'Edit' and c.country_id == record.country_id %}selected{% endif %}
          >
            {{ c.country_name }} ({{ c.country_code }})
          </option>
        {% endfor %}
      </select>
      {% if action == 'Edit' %}
        <div class="form-text">Country cannot be changed while editing.</div>
      {% endif %}
    </div>

    <div class="col-md-4">
      <label for="freshwater_indicator_id" class="form-label">Indicator</label>
      <select
        id="freshwater_indicator_id"
        name="freshwater_indicator_id"
        class="form-select"
        {% if action == 'Edit' %}disabled{% endif %}
        required
      >
        <option value="" disabled {% if action == 'Add' %}selected{% endif %}>
          Select indicator...
        </option>
        {% for ind in indicators %}
          <option value="{{ ind.freshwater_indicator_id }}"
            {% if action == 'Edit' and ind.freshwater_indicator_id == record.freshwater_indicator_id %}selected{% endif %}
          >
            {{ ind.indicator_name }} ({{ ind.unit_of_measure or '-' }})
          </option>
        {% endfor %}
      </select>
      {% if action == 'Edit' %}
        <div class="form-text">Indicator cannot be changed while editing.</div>
      {% endif %}
    </div>

    <div class="col-md-2">
      <label for="year" class="form-label">Year</label>
      <input
        type="number"
        class="form-control"
        id="year"
        name="year"
        min="1900"
        max="2100"
        value="{{ record.year if record else '' }}"
        required
      />
    </div>

    <div class="col-md-2">
      <label for="indicator_value" class="form-label">Value</label>
      <input
        type="number"
        step="0.0001"
        class="form-control"
        id="indicator_value"
        name="indicator_value"
        value="{{ record.indicator_value if record else '' }}"
        required
      />
    </div>

    <div class="col-12">
      <label for="source_notes" class="form-label">Source Notes</label>
      <textarea
        id="source_notes"
        name="source_notes"
        rows="3"
        class="form-control"
      >{{ record.source_notes if record else '' }}</textarea>
    </div>

    <div class="col-md-4">
      <label for="student_id" class="form-label">Student (Audit Log)</label>
      <select id="student_id" name="student_id" class="form-select">
        <option value="">Select student (optional)</option>
        {% for s in students %}
          <option value="{{ s.student_id }}">
            {{ s.student_number }} - {{ s.full_name }}
          </option>
        {% endfor %}
      </select>
      <div class="form-text">
        If you select a student, this operation will be stored in Audit Log.
      </div>
    </div>

    <div class="col-12 mt-3">
      <button type="submit" class="btn btn-primary">
        {{ "Create" if action == "Add" else "Update" }}
      </button>
      <a href="{{ url_for('freshwater.list_freshwater') }}" class="btn btn-secondary ms-2">
        Cancel
      </a>
    </div>
  </form>
</div>
{% endblock %}
